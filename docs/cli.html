<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLI Tool - ccap</title>
    <meta name="description" content="Command-line interface for the ccap cross-platform camera capture library.">
    <link rel="canonical" href="https://ccap.work/cli.html">
    <link rel="stylesheet" href="css/style.css">
    <!-- marked.js for markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js" crossorigin="anonymous"></script>
    <!-- DOMPurify for HTML sanitization -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js" crossorigin="anonymous"></script>
    <!-- Highlight.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/cpp.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/shell.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/makefile.min.js" crossorigin="anonymous"></script>
</head>
<body>
    <header>
        <nav class="container">
            <a href="index.html" class="logo">ccap</a>
            <button class="mobile-menu-toggle" aria-label="Toggle menu">â˜°</button>
            <ul class="nav-links">
                <li><a href="index.html#download"><span class="lang-en">Download</span><span class="lang-zh">ä¸‹è½½</span></a></li>
                <li><a href="index.html#features"><span class="lang-en">Features</span><span class="lang-zh">ç‰¹æ€§</span></a></li>
                <li><a href="index.html#quickstart"><span class="lang-en">Quick Start</span><span class="lang-zh">å¿«é€Ÿå¼€å§‹</span></a></li>
                <li><a href="documentation.html"><span class="lang-en">Documentation</span><span class="lang-zh">æ–‡æ¡£</span></a></li>
                <li><a href="cli.html"><span class="lang-en">CLI Tool</span><span class="lang-zh">CLI å·¥å…·</span></a></li>
                <li><a href="https://github.com/wysaid/CameraCapture">GitHub</a></li>
                <li><button class="lang-switch" onclick="ccap.toggleLanguage()">ğŸŒ ä¸­æ–‡</button></li>
            </ul>
        </nav>
    </header>

    <div class="doc-layout">
        <aside class="doc-sidebar" id="doc-sidebar" role="navigation" aria-label="CLI documentation navigation">
            <p class="lang-en">Loading navigation...</p>
            <p class="lang-zh">æ­£åœ¨åŠ è½½å¯¼èˆª...</p>
        </aside>

        <main class="doc-content" id="doc-content">
            <div class="doc-loading">
                <p class="lang-en">Loading CLI documentation...</p>
                <p class="lang-zh">æ­£åœ¨åŠ è½½ CLI æ–‡æ¡£...</p>
            </div>
        </main>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4 class="lang-en">Download</h4>
                    <h4 class="lang-zh">ä¸‹è½½</h4>
                    <ul>
                        <li><a href="https://github.com/wysaid/CameraCapture/releases"><span class="lang-en">Releases</span><span class="lang-zh">ç‰ˆæœ¬å‘å¸ƒ</span></a></li>
                        <li><a href="https://github.com/wysaid/CameraCapture/releases/latest"><span class="lang-en">Latest Release</span><span class="lang-zh">æœ€æ–°ç‰ˆæœ¬</span></a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4 class="lang-en">Documentation</h4>
                    <h4 class="lang-zh">æ–‡æ¡£</h4>
                    <ul>
                        <li><a href="documentation.html"><span class="lang-en">Main Documentation</span><span class="lang-zh">ä¸»æ–‡æ¡£</span></a></li>
                        <li><a href="cli.html"><span class="lang-en">CLI Tool</span><span class="lang-zh">CLI å·¥å…·</span></a></li>
                        <li><a href="https://github.com/wysaid/CameraCapture/blob/main/docs/C_Interface.md">C Interface</a></li>
                        <li><a href="https://github.com/wysaid/CameraCapture/blob/main/docs/CMAKE_OPTIONS.md"><span class="lang-en">CMake Options</span><span class="lang-zh">CMake é€‰é¡¹</span></a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4 class="lang-en">Community</h4>
                    <h4 class="lang-zh">ç¤¾åŒº</h4>
                    <ul>
                        <li><a href="https://github.com/wysaid/CameraCapture">GitHub</a></li>
                        <li><a href="https://github.com/wysaid/CameraCapture/issues">Issues</a></li>
                        <li><a href="https://github.com/wysaid/CameraCapture/pulls">Pull Requests</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4 class="lang-en">License</h4>
                    <h4 class="lang-zh">è®¸å¯è¯</h4>
                    <ul>
                        <li><a href="https://github.com/wysaid/CameraCapture/blob/main/LICENSE">MIT License</a></li>
                        <li>Â© 2025 Wang Yang</li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>ccap - Cross-Platform Camera Capture Library</p>
            </div>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script>
        // This script is embedded into the HTML to ensure proper execution order
        // and access to local functions from the documentation.html implementation.
        (function() {
            if (typeof marked === 'undefined') {
                console.error('Marked.js not loaded');
                return;
            }

            marked.setOptions({
                breaks: true,
                gfm: true,
                highlight: function(code, lang) {
                    return code; // Let hljs handle it
                }
            });

            function getCurrentLang() {
                return document.documentElement.getAttribute('lang') || 'en';
            }

            function sanitizeHtml(html) {
                if (typeof DOMPurify !== 'undefined') {
                    return DOMPurify.sanitize(html, {
                        ALLOWED_TAGS: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'br', 'hr', 
                                       'ul', 'ol', 'li', 'pre', 'code', 'blockquote',
                                       'table', 'thead', 'tbody', 'tr', 'th', 'td',
                                       'a', 'strong', 'em', 'del', 'img', 'span', 'div'],
                        ALLOWED_ATTR: ['href', 'src', 'alt', 'title', 'class', 'id'],
                        KEEP_CONTENT: true,
                        ALLOW_DATA_ATTR: false
                    });
                }
                return html;
            }

            function slugify(text) {
                if (!text) return '';
                return text
                    .toLowerCase()
                    .trim()
                    .replace(/[^\w\s-]/g, '')
                    .replace(/\s+/g, '-');
            }

            function generateSidebar() {
                var content = document.getElementById('doc-content');
                var headings = content.querySelectorAll('h2, h3');
                var sidebar = document.getElementById('doc-sidebar');
                
                if (headings.length === 0) {
                    sidebar.innerHTML = '';
                    return;
                }
                
                var nav = document.createElement('ul');
                nav.className = 'doc-nav';
                
                headings.forEach(function(heading) {
                    var level = parseInt(heading.tagName.charAt(1));
                    var text = heading.textContent;
                    var slug = heading.id || slugify(text);
                    
                    if (!heading.id) {
                        heading.id = slug;
                    }
                    
                    var li = document.createElement('li');
                    li.className = 'doc-nav-item level-' + level;
                    
                    var a = document.createElement('a');
                    a.href = '#' + slug;
                    a.textContent = text;
                    a.className = 'doc-nav-link';
                    
                    li.appendChild(a);
                    nav.appendChild(li);
                });
                
                sidebar.innerHTML = '';
                sidebar.appendChild(nav);
            }

            function initScrollSpy() {
                var navLinks = document.querySelectorAll('.doc-nav-link');
                if (navLinks.length === 0) return;
                
                function updateActiveLink() {
                    var scrollPos = window.scrollY + 100;
                    var headings = document.querySelectorAll('.doc-content h2, .doc-content h3');
                    
                    navLinks.forEach(function(link) {
                        link.classList.remove('active');
                    });
                    
                    for (var i = headings.length - 1; i >= 0; i--) {
                        if (headings[i].offsetTop <= scrollPos) {
                            var id = headings[i].id;
                            var activeLink = document.querySelector('.doc-nav-link[href="#' + id + '"]');
                            if (activeLink) {
                                activeLink.classList.add('active');
                            }
                            break;
                        }
                    }
                }
                
                window.addEventListener('scroll', function() {
                    window.requestAnimationFrame(updateActiveLink);
                });
                
                updateActiveLink();
            }

            function loadCliDocumentation() {
                var lang = getCurrentLang();
                var primaryFile = lang === 'zh' ? 'content/cli.zh.md' : 'content/cli.md';
                var fallbackFile = 'content/cli.md';
                
                fetch(primaryFile)
                    .then(function(response) {
                        if (!response.ok && lang === 'zh') {
                            return fetch(fallbackFile);
                        }
                        if (!response.ok) {
                            throw new Error('Failed to load CLI documentation');
                        }
                        return response;
                    })
                    .then(function(response) {
                        return response.text();
                    })
                    .then(function(markdown) {
                        var rawHtml = marked.parse(markdown);
                        var safeHtml = sanitizeHtml(rawHtml);
                        document.getElementById('doc-content').innerHTML = safeHtml;
                        
                        setTimeout(function() {
                            if (typeof hljs !== 'undefined') {
                                var codeBlocks = document.querySelectorAll('#doc-content pre code');
                                codeBlocks.forEach(function(block) {
                                    hljs.highlightElement(block);
                                });
                            }
                        }, 0);
                        
                        generateSidebar();
                        initScrollSpy();
                    })
                    .catch(function(error) {
                        console.error('Error loading CLI documentation:', error);
                        document.getElementById('doc-content').innerHTML = 
                            '<p class="lang-en">Failed to load CLI documentation. <a href="https://github.com/wysaid/CameraCapture/blob/main/cli/README.md">View on GitHub</a></p>' +
                            '<p class="lang-zh">åŠ è½½ CLI æ–‡æ¡£å¤±è´¥ã€‚<a href="https://github.com/wysaid/CameraCapture/blob/main/cli/README.zh-CN.md">åœ¨ GitHub ä¸ŠæŸ¥çœ‹</a></p>';
                    });
            }

            // Load documentation on page load
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', loadCliDocumentation);
            } else {
                loadCliDocumentation();
            }

            // Reload on language change
            window.addEventListener('storage', function(e) {
                if (e.key === 'ccap-lang') {
                    loadCliDocumentation();
                }
            });
        })();
    </script>
</body>
</html>
