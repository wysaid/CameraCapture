<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation - ccap</title>
    <meta name="description" content="Complete documentation for the ccap cross-platform camera capture library.">
    <link rel="canonical" href="https://ccap.work/documentation.html">
    <link rel="stylesheet" href="css/style.css">
    <!-- marked.js for markdown rendering - using specific version for stability -->
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js" crossorigin="anonymous"></script>
</head>
<body>
    <header>
        <nav class="container">
            <a href="index.html" class="logo">ccap</a>
            <button class="mobile-menu-toggle" aria-label="Toggle menu">‚ò∞</button>
            <ul class="nav-links">
                <li><a href="index.html#download"><span class="lang-en">Download</span><span class="lang-zh">‰∏ãËΩΩ</span></a></li>
                <li><a href="index.html#features"><span class="lang-en">Features</span><span class="lang-zh">ÁâπÊÄß</span></a></li>
                <li><a href="index.html#quickstart"><span class="lang-en">Quick Start</span><span class="lang-zh">Âø´ÈÄüÂºÄÂßã</span></a></li>
                <li><a href="documentation.html"><span class="lang-en">Documentation</span><span class="lang-zh">ÊñáÊ°£</span></a></li>
                <li><a href="https://github.com/wysaid/CameraCapture">GitHub</a></li>
                <li><button class="lang-switch" onclick="ccap.toggleLanguage()">üåê ‰∏≠Êñá</button></li>
            </ul>
        </nav>
    </header>

    <div class="doc-layout">
        <aside class="doc-sidebar" id="doc-sidebar">
            <p class="lang-en">Loading navigation...</p>
            <p class="lang-zh">Ê≠£Âú®Âä†ËΩΩÂØºËà™...</p>
        </aside>

        <main class="doc-content" id="doc-content">
            <div class="doc-loading">
                <p class="lang-en">Loading documentation...</p>
                <p class="lang-zh">Ê≠£Âú®Âä†ËΩΩÊñáÊ°£...</p>
            </div>
        </main>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4 class="lang-en">Download</h4>
                    <h4 class="lang-zh">‰∏ãËΩΩ</h4>
                    <ul>
                        <li><a href="https://github.com/wysaid/CameraCapture/releases"><span class="lang-en">Releases</span><span class="lang-zh">ÁâàÊú¨ÂèëÂ∏É</span></a></li>
                        <li><a href="https://github.com/wysaid/CameraCapture/releases/latest"><span class="lang-en">Latest Release</span><span class="lang-zh">ÊúÄÊñ∞ÁâàÊú¨</span></a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4 class="lang-en">Documentation</h4>
                    <h4 class="lang-zh">ÊñáÊ°£</h4>
                    <ul>
                        <li><a href="#"><span class="lang-en">Overview</span><span class="lang-zh">Ê¶ÇËø∞</span></a></li>
                        <li><a href="C_Interface.md">C Interface</a></li>
                        <li><a href="CMAKE_OPTIONS.md"><span class="lang-en">CMake Options</span><span class="lang-zh">CMake ÈÄâÈ°π</span></a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4 class="lang-en">Community</h4>
                    <h4 class="lang-zh">Á§æÂå∫</h4>
                    <ul>
                        <li><a href="https://github.com/wysaid/CameraCapture">GitHub</a></li>
                        <li><a href="https://github.com/wysaid/CameraCapture/issues">Issues</a></li>
                        <li><a href="https://github.com/wysaid/CameraCapture/pulls">Pull Requests</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4 class="lang-en">License</h4>
                    <h4 class="lang-zh">ËÆ∏ÂèØËØÅ</h4>
                    <ul>
                        <li><a href="https://github.com/wysaid/CameraCapture/blob/main/LICENSE">MIT License</a></li>
                        <li>¬© 2025 Wang Yang</li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>ccap - Cross-Platform Camera Capture Library</p>
            </div>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script>
        (function() {
            // Configure marked.js with sanitization options
            if (typeof marked !== 'undefined') {
                marked.setOptions({
                    breaks: true,
                    gfm: true
                });
            }

            // Get the current language
            function getCurrentLang() {
                return document.documentElement.getAttribute('lang') || 'en';
            }

            // Debounce utility to prevent excessive calls
            function debounce(func, wait) {
                var timeout;
                return function() {
                    var context = this;
                    var args = arguments;
                    clearTimeout(timeout);
                    timeout = setTimeout(function() {
                        func.apply(context, args);
                    }, wait);
                };
            }

            // Fetch and render markdown documentation
            function loadDocumentation() {
                var lang = getCurrentLang();
                var primaryFile = lang === 'zh' ? 'content/documentation.zh.md' : 'content/documentation.md';
                var fallbackFile = 'content/documentation.md';
                
                fetch(primaryFile)
                    .then(function(response) {
                        if (!response.ok && lang === 'zh') {
                            // Fallback to English if Chinese version not found
                            return fetch(fallbackFile);
                        }
                        if (!response.ok) {
                            throw new Error('Failed to load documentation');
                        }
                        return response;
                    })
                    .then(function(response) {
                        if (!response.ok) {
                            throw new Error('Failed to load documentation');
                        }
                        return response.text();
                    })
                    .then(function(markdown) {
                        // Render markdown to HTML using marked.js
                        var html = marked.parse(markdown);
                        document.getElementById('doc-content').innerHTML = html;
                        
                        // Generate sidebar navigation from headings
                        generateSidebar();
                        
                        // Initialize scroll spy
                        initScrollSpy();
                    })
                    .catch(function(error) {
                        console.error('Error loading documentation:', error);
                        document.getElementById('doc-content').innerHTML = 
                            '<p class="lang-en">Failed to load documentation. Please try again later.</p>' +
                            '<p class="lang-zh">Âä†ËΩΩÊñáÊ°£Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï„ÄÇ</p>';
                    });
            }

            // Generate sidebar navigation from h2 and h3 headings
            function generateSidebar() {
                var content = document.getElementById('doc-content');
                var sidebar = document.getElementById('doc-sidebar');
                var headings = content.querySelectorAll('h2, h3');
                
                if (headings.length === 0) {
                    sidebar.innerHTML = '<p>No sections found</p>';
                    return;
                }

                var html = '';
                var currentH2 = null;
                
                headings.forEach(function(heading, index) {
                    // Add an id to each heading if it doesn't have one
                    if (!heading.id) {
                        heading.id = 'section-' + index;
                    }
                    
                    var text = heading.textContent;
                    var id = heading.id;
                    
                    if (heading.tagName === 'H2') {
                        if (currentH2) {
                            html += '</ul>';
                        }
                        html += '<h3>' + escapeHtml(text) + '</h3>';
                        html += '<ul>';
                        currentH2 = heading;
                    } else if (heading.tagName === 'H3') {
                        html += '<li><a href="#' + id + '">' + escapeHtml(text) + '</a></li>';
                    }
                });
                
                if (currentH2) {
                    html += '</ul>';
                }
                
                sidebar.innerHTML = html;
            }

            // Simple HTML escaping
            function escapeHtml(text) {
                var div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            // Initialize scroll spy for sidebar
            function initScrollSpy() {
                var headings = document.querySelectorAll('#doc-content h2, #doc-content h3');
                var sidebarLinks = document.querySelectorAll('#doc-sidebar a');
                
                function updateActiveLink() {
                    var scrollY = window.scrollY;
                    var currentHeading = null;
                    
                    headings.forEach(function(heading) {
                        var rect = heading.getBoundingClientRect();
                        if (rect.top <= 100) {
                            currentHeading = heading;
                        }
                    });
                    
                    sidebarLinks.forEach(function(link) {
                        link.classList.remove('active');
                        if (currentHeading && link.getAttribute('href') === '#' + currentHeading.id) {
                            link.classList.add('active');
                        }
                    });
                }
                
                window.addEventListener('scroll', updateActiveLink);
                updateActiveLink();
            }

            // Debounced version of loadDocumentation to prevent excessive calls
            var debouncedLoadDocumentation = debounce(loadDocumentation, 100);

            // Listen for language changes with debouncing
            var observer = new MutationObserver(function(mutations) {
                var langChanged = mutations.some(function(mutation) {
                    return mutation.type === 'attributes' && mutation.attributeName === 'lang';
                });
                if (langChanged) {
                    debouncedLoadDocumentation();
                }
            });
            
            observer.observe(document.documentElement, {
                attributes: true,
                attributeFilter: ['lang']
            });

            // Load documentation on page load
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', loadDocumentation);
            } else {
                loadDocumentation();
            }
        })();
    </script>
</body>
</html>
